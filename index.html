<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE IRON SAGA</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Almendra:wght@400;700&family=MedievalSharp&display=swap" rel="stylesheet">
    <style>
        :root {
            --blood-red: #8b0000; --forest-green: #1b3022; --parchment: #d2b48c;
            --stone-dark: #1a1a1a; --wood-trim: #3e2723; --gold: #c5a059;
        }
        body {
            background-color: var(--stone-dark); color: var(--parchment);
            font-family: 'Almendra', serif; background-image: url('https://www.transparenttextures.com/patterns/dark-leather.png');
            margin: 0; padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        header { text-align: center; border-bottom: 4px double var(--wood-trim); padding-bottom: 10px; margin-bottom: 20px; }
        h1, h2, h3 { font-family: 'MedievalSharp', cursive; color: var(--gold); }
        
        nav { display: flex; justify-content: space-around; background: var(--wood-trim); padding: 10px; border: 2px solid var(--gold); margin-bottom: 20px; }
        nav button { background: transparent; border: none; color: var(--parchment); cursor: pointer; font-family: 'MedievalSharp'; }
        nav button.active { color: var(--blood-red); text-shadow: 0 0 5px var(--gold); }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .runic-card { background: rgba(27, 48, 34, 0.8); border: 3px solid var(--wood-trim); padding: 20px; margin-bottom: 15px; box-shadow: inset 0 0 15px #000; }
        
        /* BOSS UI */
        .boss-area { text-align: center; margin-bottom: 20px; border: 2px solid var(--blood-red); padding: 15px; background: rgba(0,0,0,0.5); }
        .hp-bar { height: 20px; background: #333; border: 1px solid var(--gold); position: relative; margin-top: 10px; }
        .hp-fill { height: 100%; background: linear-gradient(to right, #440000, #ff0000); transition: width 0.5s ease-in-out; }

        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .stat-box { text-align: center; border: 1px solid var(--gold); padding: 10px; background: rgba(0,0,0,0.3); }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid var(--wood-trim); }
        
        .action-btn { background: var(--blood-red); color: white; border: 1px solid var(--gold); padding: 5px 10px; cursor: pointer; font-family: 'MedievalSharp'; }
        .rune-btn { width: 30px; height: 30px; cursor: pointer; fill: #555; }
        .rune-btn.complete { fill: var(--gold); filter: drop-shadow(0 0 5px var(--gold)); }
    </style>
</head>
<body>

<div class="container">
    <header><h1>The Iron Saga</h1></header>

    <nav>
        <button onclick="showPage('longhouse')" id="nav-longhouse" class="active">Longhouse</button>
        <button onclick="showPage('quests')" id="nav-quests">Quests</button>
        <button onclick="showPage('settings')" id="nav-settings">Settings</button>
    </nav>

    <section id="longhouse" class="page active">
        <div class="boss-area">
            <h3>BOSS: JÃ¶rmungandr (World Serpent)</h3>
            <div class="hp-bar"><div id="boss-hp" class="hp-fill" style="width: 100%;"></div></div>
            <p id="boss-status" style="font-size: 0.8rem; margin-top: 5px;">HP: 1000/1000</p>
        </div>
        <div class="runic-card">
            <h2 id="char-name">Leighton</h2>
            <p id="char-title" style="color: var(--gold); font-style: italic;">The Unproven Voyager</p>
            <div class="stat-grid" id="stat-display"></div>
        </div>
    </section>

    <section id="quests" class="page">
        <div class="runic-card">
            <h3>Daily Rituals</h3>
            <div id="habit-list"></div>
            <div style="margin-top:15px;">
                <input type="text" id="habit-input" placeholder="New Habit...">
                <select id="habit-stat">
                    <option value="STR">STR</option><option value="INT">INT</option><option value="CHA">CHA</option>
                </select>
                <button class="action-btn" onclick="addItem('habit')">Add</button>
            </div>
        </div>
    </section>

    <section id="settings" class="page">
        <div class="runic-card">
            <h3>Saga Backup</h3>
            <p>Export your data to a JSON file to keep your history safe.</p>
            <button class="action-btn" onclick="exportSaga()">Download JSON</button>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid var(--wood-trim);">
            <p>Restore Saga:</p>
            <input type="file" id="importFile" onchange="importSaga(event)">
        </div>
    </section>
</div>

<script>
    let state = JSON.parse(localStorage.getItem('vikingSaga_v2')) || {
        stats: { STR: {lvl: 10, pts: 0}, INT: {lvl: 10, pts: 0}, CHA: {lvl: 10, pts: 0} },
        habits: [], history: {}, bossHP: 1000
    };

    function save() {
        localStorage.setItem('vikingSaga_v2', JSON.stringify(state));
        render();
    }

    function addItem(type) {
        const name = document.getElementById(`${type}-input`).value;
        const stat = document.getElementById(`${type}-stat`).value;
        if (!name) return;
        state.habits.push({ id: Date.now(), name, stat, streak: 0 });
        save();
    }

    function toggleHabit(id) {
        const today = new Date().toISOString().split('T')[0];
        if (!state.history[today]) state.history[today] = {};
        
        const isCompleting = !state.history[today][id];
        state.history[today][id] = isCompleting;

        if (isCompleting) {
            state.bossHP = Math.max(0, state.bossHP - 15);
            // Award fractional points or check level ups here
        } else {
            state.bossHP = Math.min(1000, state.bossHP + 15);
        }
        save();
    }

    function render() {
        // Render Boss
        document.getElementById('boss-hp').style.width = (state.bossHP / 10) + '%';
        document.getElementById('boss-status').innerText = `HP: ${state.bossHP}/1000`;

        // Render Stats
        document.getElementById('stat-display').innerHTML = Object.entries(state.stats).map(([k, v]) => `
            <div class="stat-box"><small>${k}</small><div>${v.lvl}</div></div>
        `).join('');

        // Render Habits
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('habit-list').innerHTML = state.habits.map(h => `
            <div class="item-row">
                <span>${h.name} (${h.stat})</span>
                <svg class="rune-btn ${(state.history[today] && state.history[today][h.id]) ? 'complete' : ''}" 
                     onclick="toggleHabit(${h.id})" viewBox="0 0 24 24">
                    <path d="M12,2L4.5,20.29L5.21,21L12,18L18.79,21L19.5,20.29L12,2Z" />
                </svg>
            </div>
        `).join('');
    }

    function exportSaga() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "my_saga.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importSaga(event) {
        const reader = new FileReader();
        reader.onload = e => {
            state = JSON.parse(e.target.result);
            save();
        };
        reader.readAsText(event.target.files[0]);
    }

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById('nav-' + id).classList.add('active');
    }

    render();
</script>
</body>
</html>
